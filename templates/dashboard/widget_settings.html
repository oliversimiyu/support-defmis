{% extends 'dashboard/base.html' %}

{% block title %}Widget Settings - Chat Platform{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Chat Widget Settings</h2>
    </div>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Widget Configuration</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="name" class="form-label">Widget Name</label>
                            <input type="text" class="form-control" id="name" name="name" 
                                   value="{{ widget.name }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="welcome_message" class="form-label">Welcome Message</label>
                            <textarea class="form-control" id="welcome_message" name="welcome_message" 
                                      rows="3" required>{{ widget.welcome_message }}</textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="primary_color" class="form-label">Primary Color</label>
                            <input type="color" class="form-control form-control-color" id="primary_color" 
                                   name="primary_color" value="{{ widget.primary_color }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="widget_position" class="form-label">Widget Position</label>
                            <select class="form-select" id="widget_position" name="widget_position" required>
                                <option value="bottom-right" {% if widget.widget_position == 'bottom-right' %}selected{% endif %}>
                                    Bottom Right
                                </option>
                                <option value="bottom-left" {% if widget.widget_position == 'bottom-left' %}selected{% endif %}>
                                    Bottom Left
                                </option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="is_active" name="is_active" 
                                       {% if widget.is_active %}checked{% endif %}>
                                <label class="form-check-label" for="is_active">
                                    Widget Active
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i> Save Settings
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Integration Code</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">Add this code to your website before the closing &lt;/body&gt; tag:</p>
                    
                    <textarea class="form-control" rows="10" readonly style="font-family: monospace; font-size: 12px;">&lt;script&gt;
  window.DEFMISChat = {
    apiUrl: '{{ request.scheme }}://{{ request.get_host }}',
    customerId: null, // Auto-generated
    customerName: '', // Optional
    customerEmail: '' // Optional
  };
&lt;/script&gt;
&lt;script src="{{ request.scheme }}://{{ request.get_host }}/static/js/chat-widget.js"&gt;&lt;/script&gt;</textarea>
                    
                    <button class="btn btn-sm btn-outline-secondary mt-2" onclick="copyToClipboard()">
                        <i class="fas fa-copy me-1"></i> Copy Code
                    </button>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="mb-0">Preview</h5>
                </div>
                <div class="card-body text-center">
                    <div style="
                        width: 60px; 
                        height: 60px; 
                        background-color: {{ widget.primary_color }}; 
                        border-radius: 50%; 
                        margin: 20px auto; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center;
                    ">
                        <i class="fas fa-comments text-white"></i>
                    </div>
                    <p class="text-muted">Widget will appear in {{ widget.get_widget_position_display }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyToClipboard() {
    const textarea = document.querySelector('textarea[readonly]');
    textarea.select();
    document.execCommand('copy');
    
    // Show feedback
    const button = event.target.closest('button');
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check me-1"></i> Copied!';
    button.classList.add('btn-success');
    button.classList.remove('btn-outline-secondary');
    
    setTimeout(() => {
        button.innerHTML = originalText;
        button.classList.remove('btn-success');
        button.classList.add('btn-outline-secondary');
    }, 2000);
}
</script>
{% endblock %}